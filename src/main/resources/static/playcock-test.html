<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Playcock Admin Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 16px; line-height: 1.35; }
        h1 { margin: 0 0 12px; }
        h2 { margin: 0 0 10px; font-size: 18px; }
        .row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
        .box { border: 1px solid #ddd; padding: 12px; border-radius: 8px; margin-bottom: 12px; }
        input, select, button { padding: 8px; }
        button { cursor:pointer; }
        .muted { color:#666; font-size: 13px; }
        .grid { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
        @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }
        pre { background:#f7f7f7; padding: 10px; border-radius: 8px; overflow:auto; max-height: 360px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #eee; padding: 8px; font-size: 14px; }
        th { background:#fafafa; text-align:left; }
        .pill { display:inline-block; padding:2px 8px; border:1px solid #ddd; border-radius:999px; font-size:12px; margin-right:6px;}
        .ok { border-color: #b8e2b8; background:#effaef; }
        .warn { border-color:#f3d1a1; background:#fff7ea; }
        .bad { border-color:#f0b4b4; background:#fff0f0; }
        .sectionTitle { display:flex; justify-content:space-between; align-items:center; gap:10px;}
    </style>
</head>
<body>

<h1>ğŸ¸ Playcock í†µí•© ê´€ë¦¬ì í…ŒìŠ¤íŠ¸</h1>
<div class="muted">
    ê°™ì€ ì„œë²„(<code>localhost:8080</code>)ì—ì„œ HTMLì„ ì„œë¹™í•˜ë©´ CORS ì—†ì´ ë°”ë¡œ ë™ì‘í•©ë‹ˆë‹¤.
    <br/>ì£¼ì†Œ: <code>http://localhost:8080/playcock-admin.html</code>
</div>

<div class="grid">

    <!-- LEFT: ClubPlayer -->
    <div>
        <div class="box">
            <div class="sectionTitle">
                <h2>1) ë©¤ë²„(ClubPlayer) ë“±ë¡</h2>
                <button onclick="loadPlayers()">ë©¤ë²„ ìƒˆë¡œê³ ì¹¨</button>
            </div>

            <div class="row">
                <input id="pName" placeholder="ì´ë¦„ (ì˜ˆ: ì² ìˆ˜)" />
                <select id="pType">
                    <option value="MEMBER">MEMBER(ë¶€ì›)</option>
                    <option value="GUEST">GUEST(ê²ŒìŠ¤íŠ¸)</option>
                    <option value="ETC">ETC(ê¸°íƒ€)</option>
                </select>
                <select id="pGender">
                    <option value="MALE">M(ë‚¨)</option>
                    <option value="FEMALE">F(ì—¬)</option>
                </select>
                <button onclick="createPlayer()">ë“±ë¡</button>
            </div>

            <div class="muted">â€» enum ê°’ì´ ë„¤ ì½”ë“œì™€ ë‹¤ë¥´ë©´(ì˜ˆ: MALE/FEMALE) ì•„ë˜ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ê°’ë§Œ ë°”ê¾¸ë©´ ë©ë‹ˆë‹¤.</div>
        </div>

        <div class="box">
            <div class="sectionTitle">
                <h2>2) ë©¤ë²„ ëª©ë¡ & ì„¸ì…˜ ì°¸ê°€ì ì„ íƒ</h2>
                <div class="row">
                    <button onclick="selectAllPlayers()">ì „ì²´ ì„ íƒ</button>
                    <button onclick="clearSelectedPlayers()">ì„ íƒ í•´ì œ</button>
                </div>
            </div>

            <div class="muted">ì„¸ì…˜ ì‹œì‘í•  ì°¸ê°€ìë¥¼ ì²´í¬í•˜ì„¸ìš”.</div>
            <div style="margin-top:10px; overflow:auto; max-height:320px;">
                <table>
                    <thead>
                    <tr>
                        <th>ì„ íƒ</th>
                        <th>ID</th>
                        <th>ì´ë¦„</th>
                        <th>ìœ í˜•</th>
                        <th>ì„±ë³„</th>
                    </tr>
                    </thead>
                    <tbody id="playersTbody"></tbody>
                </table>
            </div>

            <div class="row" style="margin-top:10px;">
                <button onclick="startSessionFromSelected()">ì„¸ì…˜ ì‹œì‘(ì„ íƒí•œ ë©¤ë²„)</button>
                <button onclick="endSession()">ì„¸ì…˜ ì¢…ë£Œ(end)</button>
            </div>
            <div class="muted">
                ì„¸ì…˜ ì‹œì‘ í›„ì—ëŠ” ëŒ€ì‹œë³´ë“œì—ì„œ LIST/WAITING/PLAYINGì´ ë³´ì…ë‹ˆë‹¤.
            </div>
        </div>
    </div>

    <!-- RIGHT: Session / Waiting / Playing -->
    <div>
        <div class="box">
            <div class="sectionTitle">
                <h2>3) ì„¸ì…˜ ëŒ€ì‹œë³´ë“œ</h2>
                <button onclick="loadDashboard()">ëŒ€ì‹œë³´ë“œ ì¡°íšŒ</button>
            </div>
            <div id="sessionSummary" class="muted"></div>
            <pre id="dashboardJson"></pre>
        </div>

        <div class="box">
            <div class="sectionTitle">
                <h2>4) WAITING íŒ€ ìƒì„±/ì‚­ì œ</h2>
                <button onclick="loadDashboard()">ëŒ€ì‹œë³´ë“œ ìƒˆë¡œê³ ì¹¨</button>
            </div>

            <div class="muted">
                LISTì—ì„œ 1~4ëª…ì„ ê³¨ë¼ íŒ€ì„ ë§Œë“¤ì–´ WAITING íì— ìŒ“ìŠµë‹ˆë‹¤.
            </div>

            <div class="row" style="margin-top:10px;">
                <input id="waitingPickIds" placeholder="LISTì—ì„œ ê³ ë¥¼ IDë“¤ (ì˜ˆ: 1,2,3)" style="width:260px;" />
                <button onclick="createWaitingTeam()">ëŒ€ê¸°íŒ€ ìƒì„±</button>
            </div>

            <div class="row" style="margin-top:10px;">
                <input id="deleteTeamId" placeholder="waitingTeamId" />
                <button onclick="deleteWaitingTeam()">ëŒ€ê¸°íŒ€ ì‚­ì œ(í•´ì²´â†’LIST)</button>
            </div>
        </div>

        <div class="box">
            <div class="sectionTitle">
                <h2>5) ê²½ê¸° ì‹œì‘/ì¢…ë£Œ</h2>
                <button onclick="loadDashboard()">ëŒ€ì‹œë³´ë“œ ìƒˆë¡œê³ ì¹¨</button>
            </div>

            <div class="row">
                <input id="startMatchTeamId" placeholder="waitingTeamId" />
                <button onclick="startMatch()">ê²½ê¸° ì‹œì‘(WAITINGâ†’PLAYING)</button>
            </div>

            <div class="row" style="margin-top:10px;">
                <input id="endMatchId" placeholder="matchId" />
                <button onclick="endMatch()">ê²½ê¸° ì¢…ë£Œ(PLAYINGâ†’LIST)</button>
            </div>

            <div class="muted" style="margin-top:10px;">
                ì´ ê²½ê¸° ìˆ˜ëŠ” â€œê²½ê¸° ì‹œì‘â€í•  ë•Œë§ˆë‹¤ <b>+1</b> ë©ë‹ˆë‹¤. (matchNo ì¦ê°€)
            </div>
        </div>

    </div>

</div>

<div class="box">
    <div class="sectionTitle">
        <h2>ğŸ“Œ ì„œë²„ ì‘ë‹µ(ë§ˆì§€ë§‰ ìš”ì²­)</h2>
        <button onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
    </div>
    <pre id="result"></pre>
</div>

<script>
    const API = ""; // ê°™ì€ ì„œë²„ì—ì„œ ì„œë¹™í•˜ë¯€ë¡œ ë¹ˆ ë¬¸ìì—´ì´ë©´ ìƒëŒ€ê²½ë¡œ ì‚¬ìš©ë¨

    // ===== util =====
    function show(obj) {
        document.getElementById("result").textContent = JSON.stringify(obj, null, 2);
    }
    function showText(text) {
        document.getElementById("result").textContent = String(text);
    }
    function clearLog() {
        document.getElementById("result").textContent = "";
    }

    async function fetchJson(url, options) {
        const res = await fetch(API + url, options);
        const text = await res.text();
        let body;
        try { body = text ? JSON.parse(text) : null; } catch { body = text; }

        if (!res.ok) {
            const err = { status: res.status, statusText: res.statusText, url, body };
            show(err);
            throw err;
        }
        return body;
    }

    function parseIds(input) {
        return input.split(",")
            .map(s => s.trim())
            .filter(Boolean)
            .map(Number)
            .filter(n => !Number.isNaN(n));
    }

    // ===== ClubPlayer =====
    async function loadPlayers() {
        const data = await fetchJson("/club-players", { method: "GET" });
        renderPlayersTable(data);
        show({ ok: true, action: "GET /club-players", data });
    }

    function renderPlayersTable(players) {
        const tbody = document.getElementById("playersTbody");
        tbody.innerHTML = "";

        (players || []).forEach(p => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
        <td><input type="checkbox" class="playerCheck" data-id="${p.id}"/></td>
        <td>${p.id}</td>
        <td>${p.name}</td>
        <td>${p.type}</td>
        <td>${p.gender}</td>
      `;
            tbody.appendChild(tr);
        });
    }

    async function createPlayer() {
        const name = document.getElementById("pName").value.trim();
        const type = document.getElementById("pType").value;
        const gender = document.getElementById("pGender").value;

        if (!name) {
            showText("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.");
            return;
        }

        // ë„ˆì˜ ClubPlayerCreateRequest DTOì— ë§ê²Œ í•„ë“œëª…ì´ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ:
        // ë³´í†µ { "name": "...", "type": "...", "gender": "..." }
        const payload = { name, type, gender };

        const data = await fetchJson("/club-players", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        show({ ok: true, action: "POST /club-players", payload, data });
        await loadPlayers();
    }

    function selectAllPlayers() {
        document.querySelectorAll(".playerCheck").forEach(ch => ch.checked = true);
    }

    function clearSelectedPlayers() {
        document.querySelectorAll(".playerCheck").forEach(ch => ch.checked = false);
    }

    function getSelectedPlayerIds() {
        return Array.from(document.querySelectorAll(".playerCheck"))
            .filter(ch => ch.checked)
            .map(ch => Number(ch.dataset.id));
    }

    // ===== Session =====
    async function startSessionFromSelected() {
        const ids = getSelectedPlayerIds();
        if (ids.length === 0) {
            showText("ì„¸ì…˜ ì‹œì‘í•  ë©¤ë²„ë¥¼ ì²´í¬í•˜ì„¸ìš”.");
            return;
        }

        const payload = { participantClubPlayerIds: ids };

        const data = await fetchJson("/sessions/start", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        show({ ok: true, action: "POST /sessions/start", payload, data });
        renderDashboard(data);
    }

    async function loadDashboard() {
        const data = await fetchJson("/sessions/current/dashboard", { method: "GET" });
        show({ ok: true, action: "GET /sessions/current/dashboard", data });
        renderDashboard(data);
    }

    function renderDashboard(d) {
        document.getElementById("dashboardJson").textContent = JSON.stringify(d, null, 2);

        const sum = document.getElementById("sessionSummary");
        if (!d || !d.session) {
            sum.innerHTML = `<span class="pill bad">ì„¸ì…˜ ì—†ìŒ</span> /sessions/start ë¡œ ì„¸ì…˜ì„ ì‹œì‘í•˜ì„¸ìš”.`;
            return;
        }
        sum.innerHTML = `
      <span class="pill ok">ACTIVE</span>
      sessionId=${d.session.sessionId},
      startedAt=${d.session.startedAt},
      totalMatches=${d.session.totalMatches}
      <br/>
      LIST=${(d.list||[]).length}ëª… /
      WAITING teams=${(d.waitingTeams||[]).length}ê°œ /
      PLAYING matches=${(d.playingMatches||[]).length}ê°œ
    `;
    }

    async function endSession() {
        await fetchJson("/sessions/current/end", { method: "POST" });
        show({ ok: true, action: "POST /sessions/current/end" });
    }

    // ===== Waiting Team =====
    async function createWaitingTeam() {
        const ids = parseIds(document.getElementById("waitingPickIds").value);
        if (ids.length < 1 || ids.length > 4) {
            showText("ëŒ€ê¸°íŒ€ì€ 1~4ëª… IDë¥¼ ì…ë ¥í•˜ì„¸ìš”. ì˜ˆ: 1,2,3");
            return;
        }

        const payload = { clubPlayerIds: ids };

        const data = await fetchJson("/waiting-teams", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        show({ ok: true, action: "POST /waiting-teams", payload, data });
        renderDashboard(data);
    }

    async function deleteWaitingTeam() {
        const teamId = Number(document.getElementById("deleteTeamId").value);
        if (!teamId) { showText("waitingTeamIdë¥¼ ì…ë ¥í•˜ì„¸ìš”."); return; }

        const data = await fetchJson(`/waiting-teams/${teamId}`, { method: "DELETE" });
        show({ ok: true, action: `DELETE /waiting-teams/${teamId}`, data });
        renderDashboard(data);
    }

    // ===== Match =====
    async function startMatch() {
        const teamId = Number(document.getElementById("startMatchTeamId").value);
        if (!teamId) { showText("waitingTeamIdë¥¼ ì…ë ¥í•˜ì„¸ìš”."); return; }

        const payload = { waitingTeamId: teamId };
        const data = await fetchJson("/matches/start", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        show({ ok: true, action: "POST /matches/start", payload, data });
        renderDashboard(data);
    }

    async function endMatch() {
        const matchId = Number(document.getElementById("endMatchId").value);
        if (!matchId) { showText("matchIdë¥¼ ì…ë ¥í•˜ì„¸ìš”."); return; }

        const data = await fetchJson(`/matches/${matchId}/end`, { method: "POST" });
        show({ ok: true, action: `POST /matches/${matchId}/end`, data });
        renderDashboard(data);
    }

    // ===== init =====
    (async function init() {
        try {
            await loadPlayers();
        } catch (e) {
            // ë©¤ë²„ APIê°€ ì•„ì§ ì—†ìœ¼ë©´ ì—¬ê¸°ì„œ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŒ
            show({ hint: "ë©¤ë²„ API(/club-players)ê°€ ì—†ê±°ë‚˜ ê²½ë¡œê°€ ë‹¤ë¥´ë©´ ê²½ë¡œë¥¼ ë§ì¶°ì£¼ì„¸ìš”.", error: e });
        }
    })();
</script>

</body>
</html>
